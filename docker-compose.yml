version: '3.9'
services:
  mysql:
    image: mysql:8.0
    container_name: dat-mysql
    restart: unless-stopped
    environment:
      - MYSQL_ROOT_PASSWORD=tracker
      - MYSQL_DATABASE=tracker
      - MYSQL_USER=tracker
      - MYSQL_PASSWORD=tracker
    ports:
      - "3306:3306"
    volumes:
      - ./data/mysql:/var/lib/mysql

  server:
    build:
      context: .
      dockerfile: Dockerfile.server
    container_name: dat-server
    restart: unless-stopped
    depends_on:
      - mysql
    environment:
      - AUTH_DIR=/app/auth_info_baileys
      - COOKIE_SECURE=false
      - JWT_SECRET=please-change-me-to-a-long-secret-32chars-min
      - MYSQL_HOST=mysql
      - MYSQL_PORT=3306
      - MYSQL_USER=tracker
      - MYSQL_PASSWORD=tracker
      - MYSQL_DATABASE=tracker
    volumes:
      - ./data/wa-auth:/app/auth_info_baileys
    ports:
      - "3005:3001"

  client:
    build:
      context: .
      dockerfile: Dockerfile.client
    container_name: dat-client
    restart: unless-stopped
    depends_on:
      - server
    environment:
      - PORT=3002
      - NEXT_PUBLIC_API_BASE=http://localhost:3005
      - NEXT_PUBLIC_SOCKET_URL=http://localhost:3005
    ports:
      - "3002:3002"
